<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>오늘의 문장</title>
<style>
body{
  margin:0;
  background:#2a2a2a;
  color:#f5f5f5;
  font-family: 'Pretendard', sans-serif;

  /* 가운데 정렬 제거 */
  display:block;

  min-height:100dvh;
  padding:40px 20px;
  box-sizing:border-box;
}

.card{
  max-width:600px;
  margin:0 auto;
}

h1{
  text-align:center;
}

.quote{
  text-align:left;
  line-height:1.7;
  font-size:22px;
  white-space:pre-line;
}


.footer{
  margin-top:40px;
  font-size:14px;
  opacity:0.4;
}

</style>
</head>
<body>
<div class="card">
<h1>오늘의 문장</h1>
<div class="quote" id="quote"></div>
<div class="footer">Buddha Object · Bilillego</div>
</div>

<script>
const quoteEl = document.getElementById("quote");
quoteEl.innerText = "불러오는 중…";

function dayOfYearKST(date = new Date()) {
  const kst = new Date(date.toLocaleString("en-US", { timeZone: "Asia/Seoul" }));
  const start = new Date(kst.getFullYear(), 0, 0);
  const diff = kst - start;
  const oneDay = 1000 * 60 * 60 * 24;
  return Math.floor(diff / oneDay); // 1~365(366)
}

// 간단하고 빠른 문자열 해시 (안전/보안용 아님, 섞기용)
function hashString(str) {
  let h = 2166136261; // FNV-1a base
  for (let i = 0; i < str.length; i++) {
    h ^= str.charCodeAt(i);
    h = Math.imul(h, 16777619);
  }
  return (h >>> 0); // unsigned
}

// 사용자 고유 키 (같은 기기/브라우저에서 유지)
function getUserKey() {
  const KEY = "bilillego_user_key_v1";
  let v = localStorage.getItem(KEY);
  if (!v) {
    // 랜덤 키 생성 후 저장
    v = (crypto?.randomUUID?.() || (Date.now() + "-" + Math.random())).toString();
    localStorage.setItem(KEY, v);
  }
  return v;
}

async function run() {
  try {
    const res = await fetch("./quotes.json", { cache: "no-store" });
    if (!res.ok) throw new Error("HTTP " + res.status);
    const quotes = await res.json();
    if (!Array.isArray(quotes) || quotes.length === 0) throw new Error("quotes.json empty");

    const userKey = getUserKey();
    const doy = dayOfYearKST(); // 오늘(한국시간)
    const seed = `${userKey}-${new Date().getFullYear()}-${doy}`;

    const index = hashString(seed) % quotes.length;
    quoteEl.innerText = quotes[index];
  } catch (e) {
    console.error(e);
    quoteEl.innerText = "문장을 불러오지 못했어요. (quotes.json 확인)";
  }
}

run();
</script>



</body>
</html>
